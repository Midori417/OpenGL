/**
* @file TitleScene.cpp
*/
#include "TitleScene.h"
using namespace FGEngine::SceneSystem;
using namespace FGEngine::ObjectSystem;
using namespace FGEngine::ResouceSystem;
using namespace FGEngine::InputSystem;
using namespace FGEngine::UI;

/**
* タイトルシーンの初期化
*
* @param engine エンジン
*/
bool TitleScene::Initialize()
{
	auto objManager = ObjectManager::GetInstance();
	auto resouceManager = ResouceManager::GetInstance();

	auto camera = objManager->CreateGameObject("Camera", Vector3(0, 0, -10), Quaternion::identity);
	camera->AddComponent<Camera>();
	objManager->SetMainCamera(camera);

	obj = objManager->CreateGameObject("GameObject", Vector3(0,0,0), Quaternion::identity);
	auto col = obj->AddComponent<SphereCollider>();
	auto mesh = obj->AddComponent<MeshRenderer>();
	mesh->mesh = resouceManager->GetGltfFile("Gundam")->meshes[0];
	mesh->materials = resouceManager->GetGltfFile("Gundam")->materials;
	mesh->shader = resouceManager->GetShader(DefalutShader::Standard3D);
	mesh->shadowShader = resouceManager->GetShader(DefalutShader::Shadow3D);
	//mesh->materials = CloneMaterialList(mesh->mesh);
	//mesh->materials[0]->mainTexture = resouceManager->GetTexture("white");

	auto material = std::make_shared<Material>();
	material->mainTexture = resouceManager->GetTexture("sky");

	skyMaterial = material;

	return true;
}

/**
* タイトルシーンの更新
*
* @param engine		エンジン
* @param deltaTime	前回の更新からの経過時間
*/
void TitleScene::Update()
{

	auto camera = obj;

	if (InputKey::GetKey(KeyCode::E))
	{
		rotY += 1 * Time::DeltaTime();
	}
	if (InputKey::GetKey(KeyCode::Q))
	{
		rotY -= 1 * Time::DeltaTime();
	}
	if (InputKey::GetKey(KeyCode::W))
	{
		camera->GetTransform()->position += camera->GetTransform()->Forward() * Time::DeltaTime();
	}
	if (InputKey::GetKey(KeyCode::S))
	{
		camera->GetTransform()->position -= camera->GetTransform()->Forward() * Time::DeltaTime();
	}
	if (InputKey::GetKey(KeyCode::A))
	{
		camera->GetTransform()->position -= camera->GetTransform()->Right() * Time::DeltaTime();
	}
	if (InputKey::GetKey(KeyCode::D))
	{
		camera->GetTransform()->position += camera->GetTransform()->Right() * Time::DeltaTime();
	}

	camera->GetTransform()->rotation = Quaternion::AngleAxis(rotX, Vector3::right) * Quaternion::AngleAxis(rotY, Vector3::up);
}

/**
* タイトルシーンの終了
*
* @param engine エンジン
*/
void TitleScene::Finalize()
{
}
